<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <title>Trò chơi Chiếc nón kỳ diệu — CodeFarm</title>
    <style>
      /* ====== Màu sắc chủ đạo theo logo CodeFarm (vàng ấm) ====== */
      :root {
        /* Màu chủ đạo theo logo CodeFarm */
        --bg: #f5f7ff; /* nền nhạt hơi xanh */
        --surface: #edf1ff; /* thẻ hơi xanh sáng */
        --primary: #112f85; /* xanh dương đậm theo mã logo */
        --primary-600: #0f2a75; /* đậm hơn để viền/hover */
        --primary-700: #0b215c; /* đậm nhất */
        --text: #0f1226; /* chữ tối */
        --muted: #5b6382; /* chữ phụ */
        --shadow: rgba(17, 47, 133, 0.15);

        /* Bố cục tổng thể */
        --app-w: 78vw;
        --app-max: 1280px;
        --slogan-w: 260px;
        --slogan-gap: 130px;
      }

      /* ===== BODY & TOP LOGO ===== */
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        min-height: 100vh;
        background: linear-gradient(180deg, var(--bg), #fff5d4 70%);
        font-family: Inter, system-ui, Arial, sans-serif;
        color: var(--text);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        padding: 28px 18px 24px;
      }
      .top-logo {
        width: 120px;
        height: auto;
        margin-bottom: 14px;
        z-index: 5;
        filter: drop-shadow(0 6px 18px var(--shadow));
      }

      /* ===== SLOGAN BLOCKS (không ảnh hưởng kích thước app) ===== */
      .slogan-card {
        position: fixed; /* tách khỏi flow của app */
        top: 50%;
        transform: translateY(-50%);
        width: var(--slogan-w);
        max-height: 70vh; /* nội dung dài sẽ cuộn trong khối */
        overflow: auto;
        background: #fff;
        border-radius: 14px;
        box-shadow: 0 14px 36px var(--shadow);
        padding: 12px 14px;
        z-index: 2; /* nằm trên nền, dưới app */
        color: var(--primary-700);
      }
      .slogan-card.left {
        left: calc(
          (100vw - min(var(--app-w), var(--app-max))) / 2 - var(--slogan-gap) -
            var(--slogan-w)
        );
      }
      .slogan-card.right {
        right: calc(
          (100vw - min(var(--app-w), var(--app-max))) / 2 - var(--slogan-gap) -
            var(--slogan-w)
        );
      }
      .slogan-title {
        font-weight: 800;
        font-size: 16px;
        letter-spacing: 0.2px;
        margin: 2px 0 8px;
      }
      .slogan-content {
        font-size: 14px;
        color: var(--muted);
      }
      .slogan-content img {
        width: 100%;
        height: auto;
        border-radius: 10px;
        display: block;
        margin-bottom: 8px;
      }

      /* ===== APP (đứng giữa) ===== */
      .app-wrap {
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
      }
      .app {
        width: var(--app-w);
        max-width: var(--app-max);
        background: var(--surface);
        border-radius: 16px;
        padding: 22px 22px 18px;
        box-shadow: 0 20px 48px var(--shadow);
        z-index: 3; /* cao hơn slogan để thao tác không bị che */
        border: 1px solid rgba(200, 145, 15, 0.12);
      }
      header {
        text-align: center;
        margin-bottom: 10px;
      }
      header h1 {
        margin: 0;
        color: var(--primary-700);
        font-size: 34px;
        font-weight: 900;
      }
      p.lead {
        text-align: center;
        color: var(--muted);
        margin: 6px 0 16px;
      }

      /* ===== BOARD ===== */
      .board {
        display: grid;
        grid-template-columns: 1fr 420px;
        gap: 18px;
        align-items: start;
      }
      .left,
      .right {
        padding: 16px;
        border-radius: 12px;
        background: #fff;
        box-shadow: 0 10px 24px var(--shadow);
      }

      /* ===== PUZZLE CELLS (tăng kích thước) ===== */
      .puzzle {
        min-height: 150px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
        gap: 12px;
      }
      .cell {
        width: 82px;
        height: 82px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        font-size: 28px;
        letter-spacing: 2px;
        box-shadow: inset 0 -2px 0 rgba(0, 0, 0, 0.06);
      }
      .cell.hidden {
        background: #ffe7a8;
        border: 2px dashed var(--primary);
      }
      .cell.revealed {
        background: var(--primary);
        color: #fff;
        text-shadow: 0 1px 0 rgba(0, 0, 0, 0.12);
      }
      .cell.space {
        width: 26px;
        background: transparent;
        border: none;
        box-shadow: none;
      }

      .status {
        margin-top: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        font-size: 14px;
        color: var(--muted);
      }

      /* ===== WIN MESSAGE + mini fireworks ===== */
      #winMsg {
        display: none;
        font-size: 44px;
        font-weight: 900;
        color: #0d7a5c;
        text-align: center;
        margin: 16px auto 8px;
        position: relative;
      }
      .fw {
        position: absolute;
        width: 48px;
        height: 48px;
        opacity: 0;
        transform: scale(0.35);
        transition: transform 0.6s ease, opacity 0.6s ease;
        pointer-events: none;
      }
      .fw.left {
        left: -68px;
        top: 50%;
        transform: translateY(-50%) scale(0.35);
      }
      .fw.right {
        right: -68px;
        top: 50%;
        transform: translateY(-50%) scale(0.35);
      }
      .fw.active {
        opacity: 1;
        transform: translateY(-50%) scale(1.6);
        animation: fireworkUp 1s ease-out;
      }
      @keyframes fireworkUp {
        0% {
          transform: translateY(20px) scale(0.4);
          opacity: 0;
        }
        40% {
          opacity: 1;
        }
        100% {
          transform: translateY(-80px) scale(1.8);
          opacity: 0;
        }
      }

      /* ===== HINT ===== */
      #hintSection {
        margin-top: 14px;
        text-align: center;
      }
      #hintText {
        font-size: 20px;
        color: var(--text);
        margin-bottom: 10px;
        font-weight: 600;
      }
      #hintImg {
        max-width: 560px;
        border-radius: 10px;
        display: block;
        margin: 0 auto;
      }

      /* ===== CONTROLS (nút) ===== */
      .controls {
        margin-top: 16px;
        display: flex;
        justify-content: center;
        gap: 14px;
      }
      button.control {
        background: var(--primary);
        border: 1px solid var(--primary-600);
        padding: 12px 22px;
        border-radius: 12px;
        color: #fff;
        font-weight: 800;
        font-size: 16px;
        cursor: pointer;
        box-shadow: 0 8px 16px var(--shadow);
        transition: transform 0.05s ease, filter 0.2s ease;
      }
      button.control:hover {
        filter: brightness(0.98) saturate(1.05);
      }
      button.control:active {
        transform: translateY(1px);
      }
      button.control:disabled {
        opacity: 0.45;
        cursor: not-allowed;
      }

      /* ===== ALPHABET (căn giữa) ===== */
      .right {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .alphabet {
        width: 100%;
        display: grid;
        grid-template-columns: repeat(6, minmax(56px, 1fr));
        gap: 10px;
        justify-items: center;
      }
      .letter {
        width: 56px;
        height: 56px;
        border-radius: 12px;
        background: var(--primary);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-weight: 900;
        color: #fff;
        border: 1px solid var(--primary-600);
        box-shadow: 0 8px 16px var(--shadow);
      }
      .letter.disabled {
        opacity: 0.35;
        cursor: not-allowed;
        filter: grayscale(0.1);
      }

      footer {
        margin-top: 14px;
        text-align: center;
        color: var(--muted);
      }

      /* ===== Responsive ===== */
      @media (max-width: 1100px) {
        .board {
          grid-template-columns: 1fr;
        }
        .right {
          order: 2;
        }
      }
      @media (max-width: 900px) {
        .slogan-card {
          display: none;
        } /* tự ẩn slogan trên mobile để tập trung vào chơi */
        .app {
          width: 94vw;
        }
        .puzzle {
          gap: 10px;
        }
        .cell {
          width: 68px;
          height: 68px;
          font-size: 24px;
        }
        .alphabet {
          grid-template-columns: repeat(6, minmax(48px, 1fr));
        }
        .letter {
          width: 48px;
          height: 48px;
        }
      }
      /* ===== Overrides theo feedback (twin fireworks) ===== */
      #winMsg {
        position: relative;
      }
      /* đặt 2 pháo hoa hai bên, khi active sẽ tụ vào giữa một chút rồi bay lên và tàng hình */
      .fw {
        position: absolute;
        width: 56px;
        height: 56px;
        opacity: 0;
        pointer-events: none;
        background: transparent !important;
        border: none !important;
        outline: none !important;
        border-radius: 0 !important;
        box-shadow: none !important;
        mix-blend-mode: normal;
        image-rendering: auto;
        backface-visibility: hidden;
        will-change: transform, opacity;
      }
      .fw.left {
        left: -68px;
        top: 50%;
        transform: translate(0, -50%) scale(0.35);
      }
      .fw.right {
        right: -68px;
        top: 50%;
        transform: translate(0, -50%) scale(0.35);
      }
      .fw.left.active {
        opacity: 1;
        animation: cfTwinLeft 1.1s ease-out forwards;
      }
      .fw.right.active {
        opacity: 1;
        animation: cfTwinRight 1.1s ease-out forwards;
      }
      @keyframes cfTwinLeft {
        0% {
          transform: translate(0, -50%) scale(0.35);
          opacity: 0;
        }
        35% {
          opacity: 1;
        }
        65% {
          transform: translate(36px, -70%) scale(1.25);
          opacity: 1;
        } /* đi vào giữa một chút */
        100% {
          transform: translate(48px, -110%) scale(1.7);
          opacity: 0;
        }
      }
      @keyframes cfTwinRight {
        0% {
          transform: translate(0, -50%) scale(0.35);
          opacity: 0;
        }
        35% {
          opacity: 1;
        }
        65% {
          transform: translate(-36px, -70%) scale(1.25);
          opacity: 1;
        }
        100% {
          transform: translate(-48px, -110%) scale(1.7);
          opacity: 0;
        }
      }

      /* Căn giữa bảng chữ cái theo chiều dọc & đồng bộ chiều cao với khu chơi */
      .board {
        align-items: stretch;
      }
      .board > .left,
      .board > .right {
        height: 100%;
      }
      .board > .right {
        display: grid;
        place-items: center;
      }

      /* Sử dụng màu chủ đạo cho các thành phần */
      header h1 {
        color: var(--primary-700);
      }
      .cell.hidden {
        background: #e2e8ff;
        border: 2px dashed var(--primary);
      }
      .cell.revealed {
        background: var(--primary);
        color: #fff;
      }
      button.control {
        background: var(--primary);
        border: 1px solid var(--primary-600);
      }
      .letter {
        background: var(--primary);
        border: 1px solid var(--primary-600);
      }
      .letter.disabled {
        opacity: 0.35;
      }
      :root {
        --panel-w: 310px;
        --panel-gap: 28px;
      }

      /* ======= SIDE PANELS (theo ảnh mẫu), cao bằng app ======= */
      .cf-panel {
        position: absolute;
        width: var(--panel-w);
        color: #fff;
        z-index: 4;
        top: 0;
        left:0;
      }
      .cf-card {
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        gap: 14px;
        background: linear-gradient(180deg, #1140a3 0%, #0b2a6a 100%);
        border-radius: 18px;
        box-shadow: 0 18px 42px rgba(17, 47, 133, 0.2);
        padding: 22px 18px;
      }

      /* LEFT CONTENT */
      .cf-icon.cf-book {
        width: 42px;
        height: 42px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.12);
        position: relative;
        margin-bottom: 8px;
      }
      .cf-icon.cf-book::after {
        content: "";
        position: absolute;
        inset: 9px;
        border: 2px solid rgba(255, 255, 255, 0.8);
        border-radius: 6px;
        border-left-color: transparent;
      }
      .cf-title {
        font-size: 18px;
        font-weight: 900;
        letter-spacing: 0.8px;
        text-transform: uppercase;
      }
      .cf-sub {
        font-size: 16px;
        opacity: 0.9;
      }
      .cf-slogan-pill {
        background: rgba(255, 255, 255, 0.12);
        border-radius: 12px;
        padding: 12px;
        font-weight: 800;
        text-align: center;
      }
      .cf-meta {
        display: flex;
        align-items: center;
        gap: 8px;
        opacity: 0.95;
      }

      /* RIGHT CTA */
      .cf-cta-badge {
        width: 56px;
        height: 56px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.14);
        display: grid;
        place-items: center;
        font-weight: 900;
        font-size: 28px;
        margin-bottom: 8px;
      }
      .cf-cta-title {
        font-size: 20px;
        font-weight: 900;
      }
      .cf-cta-sub {
        font-size: 14px;
        opacity: 0.92;
        margin: 0;
      }
      .cf-qr {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 12px;
        padding: 12px;
        display: grid;
        place-items: center;
        gap: 6px;
      }
      .cf-qr img {
        max-width: 120px;
        display: block;
      }
      .cf-qr-fallback {
        display: none;
        font-weight: 900;
        font-size: 18px;
      }
      .cf-qr img[style*="display: none"] + .cf-qr-fallback {
        display: block;
      }
      .cf-qr-caption {
        font-size: 12px;
        opacity: 0.9;
      }
      .cf-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        background: var(--primary);
        border: 1px solid var(--primary-600);
        color: #fff;
        font-weight: 800;
        padding: 12px 16px;
        border-radius: 12px;
        text-decoration: none;
        box-shadow: 0 10px 22px rgba(17, 47, 133, 0.25);
      }
      .cf-cta-foot {
        display: flex;
        gap: 8px;
        align-items: center;
        opacity: 0.9;
      }

      /* Ẩn panels trên màn nhỏ */
      @media (max-width: 1200px) {
        .cf-panel {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <!-- logo trên app -->
    <img src="./image/logo.png" alt="CodeFarm Logo" class="top-logo" />

    <!-- ====== SLOGAN 2 BÊN (có thể là ảnh hoặc text tuỳ ý; không ảnh hưởng app) ====== -->
    <aside class="cf-panel left-panel" aria-label="Panel trái">
      <div class="cf-card">
        <div class="cf-card-top">
          <div class="cf-icon cf-book" aria-hidden="true"></div>
          <div class="cf-title">CODE FARM</div>
          <div class="cf-sub">Học lập trình cùng doanh nghiệp</div>
        </div>
        <div class="cf-slogan-pill">“Hành động – Kỷ luật – Không bỏ cuộc”</div>
        <div class="cf-meta">
          <span class="cf-meta-ico" aria-hidden="true">👥</span> 1000+ học viên
        </div>
      </div>
    </aside>

    <aside class="cf-panel right-panel" aria-label="Panel phải CTA">
      <div class="cf-card">
        <div class="cf-cta-head">
          <div class="cf-cta-badge" aria-hidden="true">f</div>
          <div class="cf-cta-title">Tham gia cộng đồng</div>
          <p class="cf-cta-sub">
            Cùng nhau học hỏi và chia sẻ kinh nghiệm với hơn 1000+ thành viên
            trong cộng đồng CodeFarm
          </p>
        </div>
        <div class="cf-qr">
          <img
            src="./image/qr.png"
            alt="QR nhóm Facebook"
            onerror="this.style.display='none'"
          />
          <span class="cf-qr-fallback">QR</span>
          <div class="cf-qr-caption">Quét mã QR</div>
        </div>
        <a
          href="https://www.facebook.com/groups/"
          target="_blank"
          rel="noopener"
          class="cf-btn"
        >
          <span class="cf-btn-ico" aria-hidden="true"></span>
          Tham gia ngay
        </a>
        <div class="cf-cta-foot">
          <span>🏆 Top #1</span>
          <span>•</span>
          <span>Miễn phí</span>
        </div>
      </div>
    </aside>

    <!-- ====== APP CHÍNH GIỮA ====== -->
    <div class="app-wrap" role="main">
      <div
        class="app"
        role="application"
        aria-label="Wheel of Fortune - Tester"
      >
        <header><h1>Trò chơi Chiếc nón kỳ diệu</h1></header>
        <p class="lead">Chọn chữ cái để đoán từ khóa về tester</p>

        <div class="board">
          <!-- Vùng chơi bên trái -->
          <section class="left">
            <div class="puzzle" id="puzzle" aria-live="polite"></div>

            <div class="status">
              <div>
                Câu hỏi: <strong id="wordIndex">1</strong>/<span id="totalWords"
                  >1</span
                >
              </div>
              <div class="misses">Sai: <strong id="missCount">0</strong></div>
            </div>

            <div id="winMsg">
              🎉 Chính xác!
              <!-- Hai pháo hoa 2 bên, nổ và tụ vào giữa một chút -->
              <img
                id="fwLeft"
                class="fw left"
                src="./image/phaohoa.png"
                alt="fw-left"
              />
              <img
                id="fwRight"
                class="fw right"
                src="./image/phaohoa.png"
                alt="fw-right"
              />
            </div>

            <div id="hintSection">
              <div id="hintText"></div>
              <img id="hintImg" src="" alt="hint image" />
            </div>

            <div class="controls">
              <button id="prevBtn" class="control">Prev</button>
              <button id="revealBtn" class="control">Reveal</button>
              <button id="nextBtn" class="control">Next</button>
            </div>
          </section>

          <!-- Bảng chữ cái bên phải (được căn giữa) -->
          <aside class="right">
            <div class="alphabet" id="alphabet" aria-label="Alphabet"></div>
          </aside>
        </div>

        <footer>
          <small>© CodeFarm — Bản quyền đến từ codefarm</small>
        </footer>
      </div>
    </div>

    <!-- ====== LOGIC GAME GIỮ NGUYÊN (chỉ chỉnh giao diện) ====== -->
    <script>
      // Data + helpers
      const DEFAULT_PUZZLES = [
        {
          word: "BUG",
          question: "Đây là từ thể hiện lỗi phần mềm",
          img: "./image/test.jpg",
        },
        {
          word: "TEST CASE",
          question: "Tài liệu mô tả chi tiết từng bước kiểm thử gọi là gì?",
          img: "./image/test.jpg",
        },
        {
          word: "AUTOMATION",
          question: "Kiểm thử bằng công cụ thay vì thủ công gọi là gì?",
          img: "./image/test.jpg",
        },
        {
          word: "MANUAL",
          question: "Hình thức kiểm thử do con người trực tiếp thực hiện?",
          img: "./image/test.jpg",
        },
        {
          word: "REGRESSION",
          question: "Kiểm thử lại sau khi sửa lỗi hoặc thay đổi phần mềm?",
          img: "./image/test.jpg",
        },
        {
          word: "UNIT",
          question: "Mức kiểm thử nhỏ nhất, tập trung vào hàm hoặc module?",
          img: "./image/test.jpg",
        },
        {
          word: "INTEGRATION",
          question: "Kiểm thử khi kết hợp nhiều module lại với nhau?",
          img: "./image/test.jpg",
        },
        {
          word: "SMOKE",
          question: "Kiểm thử nhanh để xem phần mềm có chạy cơ bản không?",
          img: "./image/test.jpg",
        },
        {
          word: "PERFORMANCE",
          question: "Kiểm thử về tốc độ và khả năng chịu tải?",
          img: "./image/test.jpg",
        },
        {
          word: "UI",
          question: "Phần giao diện người dùng viết tắt là gì?",
          img: "./image/test.jpg",
        },
      ];

      const ALPHABET = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
      function normalizeForMatch(ch) {
        return ch ? ch.toUpperCase() : ch;
      }
      function isLetter(ch) {
        return /[A-Z]/i.test(ch);
      }

      // state
      let puzzles = DEFAULT_PUZZLES.slice();
      let idx = 0;
      let chars = [];
      let missCount = 0;

      // elements
      const puzzleEl = document.getElementById("puzzle");
      const alphabetEl = document.getElementById("alphabet");
      const wordIndexEl = document.getElementById("wordIndex");
      const totalWordsEl = document.getElementById("totalWords");
      const missCountEl = document.getElementById("missCount");
      const hintTextEl = document.getElementById("hintText");
      const hintImgEl = document.getElementById("hintImg");
      const winMsgEl = document.getElementById("winMsg");
      const fwLeft = document.getElementById("fwLeft");
      const fwRight = document.getElementById("fwRight");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");
      const revealBtn = document.getElementById("revealBtn");

      // Ẩn pháo hoa sau khi nổ xong (trở lại tàng hình)
      if (fwLeft) {
        fwLeft.addEventListener("animationend", () =>
          fwLeft.classList.remove("active")
        );
      }
      if (fwRight) {
        fwRight.addEventListener("animationend", () =>
          fwRight.classList.remove("active")
        );
      }

      // render alphabet buttons
      function renderAlphabet() {
        alphabetEl.innerHTML = "";
        ALPHABET.forEach((letter) => {
          const btn = document.createElement("button");
          btn.className = "letter";
          btn.textContent = letter;
          btn.dataset.letter = letter;
          btn.addEventListener("click", onLetterClick);
          alphabetEl.appendChild(btn);
        });
      }

      function buildChars(raw) {
        chars = [];
        for (const ch of raw) {
          chars.push({
            orig: ch,
            normalized: normalizeForMatch(ch),
            revealed: !isLetter(ch),
          });
        }
      }

      function renderPuzzle() {
        puzzleEl.innerHTML = "";
        chars.forEach((c) => {
          const d = document.createElement("div");
          d.className = "cell " + (c.revealed ? "revealed" : "hidden");
          if (!isLetter(c.orig) && c.orig === " ") d.className = "cell space";
          if (c.revealed && isLetter(c.orig)) d.textContent = c.orig;
          puzzleEl.appendChild(d);
        });
        checkWin();
      }

      function resetAlphabetButtons() {
        document.querySelectorAll(".letter").forEach((b) => {
          b.classList.remove("disabled");
          b.disabled = false;
        });
      }

      function onLetterClick(e) {
        const btn = e.currentTarget;
        if (btn.classList.contains("disabled")) return;
        const letter = btn.dataset.letter;
        handleGuess(letter);
        btn.classList.add("disabled");
        btn.disabled = true;
      }

      function handleGuess(letter) {
        const key = normalizeForMatch(letter);
        let found = 0;
        chars.forEach((c) => {
          if (isLetter(c.orig) && !c.revealed && c.normalized === key) {
            c.revealed = true;
            found++;
          }
        });
        if (found === 0) {
          missCount++;
          missCountEl.textContent = missCount;
        } else {
          renderPuzzle();
        }
      }

      function checkWin() {
        const done = chars.every((c) => !isLetter(c.orig) || c.revealed);
        if (done) {
          winMsgEl.style.display = "block";
          // kích hoạt animation 2 pháo hoa, tụ vào giữa một chút rồi bay lên
          if (fwLeft && fwRight) {
            fwLeft.classList.remove("active");
            fwRight.classList.remove("active");
            void fwLeft.offsetWidth; // reflow để phát lại animation
            void fwRight.offsetWidth;
            fwLeft.classList.add("active");
            fwRight.classList.add("active");
          }
          nextBtn.disabled = idx >= puzzles.length - 1;
          if (idx < puzzles.length - 1) nextBtn.disabled = false;
        } else {
          winMsgEl.style.display = "none";
          if (fwLeft) fwLeft.classList.remove("active");
          if (fwRight) fwRight.classList.remove("active");
        }
      }

      function loadPuzzle(i) {
        idx = (i + puzzles.length) % puzzles.length;
        wordIndexEl.textContent = idx + 1;
        totalWordsEl.textContent = puzzles.length;
        buildChars(puzzles[idx].word);
        missCount = 0;
        missCountEl.textContent = missCount;
        resetAlphabetButtons();
        renderPuzzle();
        hintTextEl.textContent = puzzles[idx].question;
        hintImgEl.src = puzzles[idx].img || "";
        prevBtn.disabled = idx === 0;
        nextBtn.disabled = true;
        if (idx === puzzles.length - 1) nextBtn.disabled = true;
      }

      // reveal event
      revealBtn.addEventListener("click", () => {
        chars.forEach((c) => {
          if (isLetter(c.orig)) c.revealed = true;
        });
        renderPuzzle();
        if (idx < puzzles.length - 1) nextBtn.disabled = false;
      });
      nextBtn.addEventListener("click", () => {
        if (nextBtn.disabled) return;
        loadPuzzle(idx + 1);
      });
      prevBtn.addEventListener("click", () => {
        if (prevBtn.disabled) return;
        loadPuzzle(idx - 1);
      });

      // keyboard support
      document.addEventListener("keydown", (ev) => {
        const k = ev.key.toUpperCase();
        if (k.length === 1 && /[A-Z]/i.test(k)) {
          const btn = Array.from(document.querySelectorAll(".letter")).find(
            (b) => b.textContent === k && !b.disabled
          );
          if (btn) btn.click();
        }
      });

      // init
      renderAlphabet();
      loadPuzzle(0);
      // ===== Định vị 2 panel 2 bên theo chiều cao/ vị trí của .app =====
      function positionCFPanels() {
        const app = document.querySelector(".app");
        const left = document.querySelector(".cf-panel.left-panel");
        const right = document.querySelector(".cf-panel.right-panel");
        if (!app || !left || !right) return;
        const rect = app.getBoundingClientRect();
        const panelW = parseInt(getComputedStyle(left).width) || 310;
        const gap =
          parseInt(
            getComputedStyle(document.documentElement).getPropertyValue(
              "--panel-gap"
            )
          ) || 28;
        const top = window.scrollY + rect.top;
        const leftX = window.scrollX + rect.left - gap - panelW;
        const rightX = window.scrollX + rect.right + gap;
        const h = rect.height;
        left.style.top = `${top}px`;
        left.style.left = `${leftX}px`;
        left.style.height = `${h}px`;
        right.style.top = `${top}px`;
        right.style.left = `${rightX}px`;
        right.style.height = `${h}px`;
      }
      window.addEventListener("resize", positionCFPanels);
      window.addEventListener("scroll", positionCFPanels, { passive: true });
      const __cfObs = new MutationObserver(() => positionCFPanels());
      __cfObs.observe(document.querySelector(".app"), {
        attributes: true,
        childList: true,
        subtree: true,
        characterData: true,
      });
      positionCFPanels();
    </script>
  </body>
</html>
